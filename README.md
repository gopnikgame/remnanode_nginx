# remnanode_nginx

## Быстрый старт

```bash
curl -s https://raw.githubusercontent.com/gopnikgame/remnanode_nginx/main/install_remnanode_nginx.sh -o /tmp/install_remnanode_nginx.sh && sudo bash /tmp/install_remnanode_nginx.sh
```

## Описание

Этот скрипт автоматизирует установку и настройку ноды remnawave с использованием Nginx в качестве обратного прокси. Скрипт предназначен для быстрого развертывания на серверах под управлением **Debian 11/12** или **Ubuntu 22.04/24.04**.

### Основные возможности:

- Проверка ОС (только поддерживаемые версии) и прав root.
- Установка всех необходимых пакетов (ca-certificates, curl, jq, ufw, wget, gnupg, unzip, nano, dialog, git, unattended-upgrades, locales, dnsutils, coreutils, grep, gawk, cron).
- Настройка и активация файрвола (UFW, разрешены только SSH и HTTPS).
- Автоматизация обновлений через unattended-upgrades.
- Генерация и настройка локали en_US.UTF-8.
- Ведение лога установки дополнительных компонентов.
- Генерация SSL-сертификатов Let's Encrypt (через Cloudflare API или HTTP-01).
- Автоматизация продления сертификатов и перезапуска nginx.
- Настройка docker-compose для remnawave и nginx.
- Установка случайного шаблона для маскировочного сайта.
- Проверка и настройка домена.
- **Меню для опциональной установки Tblocker (бот для Telegram-оповещений и блокировок) и WARP (WireProxy) после установки Remnanode.**

### Установка дополнительных компонентов

После основной установки скрипт предложит установить:

- **Tblocker**  
  - Требует предварительно установленный Remnanode.
  - Запросит токен Telegram-бота (создаётся через @BotFather) и Telegram ID администратора.
  - Позволяет указать длительность блокировки (по умолчанию 10 минут).
  - Опционально настраивает отправку вебхуков (адрес указывается вручную).
  - Автоматически настраивает config.yaml, volumes для docker-compose, права на директории, crontab для очистки логов.
  - После установки перезапускает сервисы и контейнеры.

- **WARP (WireProxy)**
  - Устанавливается только если ещё не установлен.
  - Запрашивает порт (по умолчанию 40000, диапазон 1000-65535).
  - Автоматизирует установку через expect-скрипт.

### Этапы установки:

1. **Запуск скрипта**  
   Выполните команду из раздела "Быстрый старт".

2. **Ответьте на вопросы скрипта**  
   - Введите selfsteal-домен, который указывали при создании инбаунда.
   - Введите IP-адрес панели.
   - Вставьте сертификат, полученный от панели.
   - Выберите способ генерации сертификата (Cloudflare API или HTTP-01).
   - При необходимости введите email для Let's Encrypt.
   - После установки Remnanode выберите в меню:  
     - Установить Tblocker  
     - Установить WARP  
     - Установить оба компонента  
     - Выйти без установки дополнительных компонентов  
   - Для Tblocker потребуется ввести токен бота, Telegram ID, длительность блокировки, при необходимости адрес вебхука.

3. **Ожидайте завершения установки**  
   Скрипт автоматически скачает и настроит все компоненты, сгенерирует сертификаты, развернёт контейнеры, настроит volumes и cron, проверит доступность ноды.

## Требования

- Debian 11/12 или Ubuntu 22.04/24.04
- Права root
- Настроенный selfsteal-домен, указывающий на ваш сервер

## Примечания

- Установка Tblocker и WARP возможна только после успешной установки Remnanode.
- Скрипт ведёт лог установки дополнительных компонентов в `/usr/local/remnawave_reverse/install_tblocker_warp.log`.
- Все действия по настройке volumes, crontab и прав доступа выполняются автоматически.

## Благодарности

Данный скрипт был разработан на основе:

- [Capybara-z/RemnaSetup](https://github.com/Capybara-z/RemnaSetup)

Спасибо авторам за их труд и идеи!